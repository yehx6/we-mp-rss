import{h as q,_ as G,d as O,x as P,y as L,r as m,k as W,e as k,f as C,c as u,u as V,w as t,F as H,n as K,M as r,j as s,o as b,l as Q,m as E,z as X}from"./index.293d4f42.js";import{g as Y,u as Z,c as ee}from"./tagManagement.dc97cdc1.js";const ue=w=>{const i=new FormData;return i.append("file",w),q.post("/wx/user/upload",i,{headers:{"Content-Type":"multipart/form-data"}})};const ae={class:"tag-form"},te={class:"cover-upload"},oe=["src"],le={class:"upload-mask"},se=O({__name:"TagForm",setup(w){const i=P(),g=L(),c=m(!1),B=m(!1),y=m(!1),a=m({name:"",cover:null,intro:null,status:1,mps_id:[]}),A={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u7B7E\u540D\u79F0"}]},S=async l=>{try{B.value=!0;const e=await Y(l);a.value={...e,mps_id:JSON.parse(e.mps_id||[])},K(()=>{D.value&&D.value.parseSelected(a.value.mps_id)})}catch{r.error("\u83B7\u53D6\u6807\u7B7E\u8BE6\u60C5\u5931\u8D25")}finally{B.value=!1}},T=async l=>{var f,p,n,v;const e=((f=l.fileItem)==null?void 0:f.file)||l.file;if(!((p=e==null?void 0:e.type)!=null&&p.startsWith("image/"))){r.error("\u8BF7\u9009\u62E9\u56FE\u7247\u6587\u4EF6 (JPEG/PNG)");return}if(e.size>2*1024*1024){r.error("\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC72MB");return}try{const d=await ue(e);console.log(d),a.value.cover=d.url}catch(d){console.error("\u4E0A\u4F20\u9519\u8BEF:",d),r.error(`\u4E0A\u4F20\u5931\u8D25: ${((v=(n=d.response)==null?void 0:n.data)==null?void 0:v.message)||d.message||"\u670D\u52A1\u5668\u9519\u8BEF"}`)}return!1},h=()=>{r.warning("\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u5C01\u9762\u6587\u4EF6")},M=l=>{r.error(`\u4E0A\u4F20\u51FA\u9519: ${l.message||"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}`)},_=m(!1),D=m(null),U=l=>{const e=l.target;e.src="/default-cover.png"},N=async()=>{try{y.value=!0;const l={...a.value,mps_id:JSON.stringify(a.value.mps_id)};c.value?(await Z(i.params.id,l),r.success("\u66F4\u65B0\u6210\u529F")):(await ee(l),r.success("\u521B\u5EFA\u6210\u529F")),g.push("/tags")}catch{r.error(c.value?"\u66F4\u65B0\u5931\u8D25":"\u521B\u5EFA\u5931\u8D25")}finally{y.value=!1}};return W(()=>{i.params.id&&(c.value=!0,S(i.params.id))}),(l,e)=>{const f=s("a-page-header"),p=s("a-input"),n=s("a-form-item"),v=s("icon-image"),d=s("icon-edit"),$=s("a-upload"),R=s("a-textarea"),z=s("a-switch"),F=s("a-button"),x=s("a-space"),I=s("a-form"),J=s("a-card"),j=s("a-modal");return b(),k(H,null,[C("div",ae,[u(f,{title:c.value?"\u7F16\u8F91\u6807\u7B7E":"\u6DFB\u52A0\u6807\u7B7E",subtitle:"\u6807\u7B7E\u4FE1\u606F",onBack:e[0]||(e[0]=o=>V(g).go(-1))},null,8,["title"]),u(J,{loading:B.value},{default:t(()=>[u(I,{model:a.value,rules:A,layout:"vertical",onSubmit:N},{default:t(()=>[u(n,{label:"\u6807\u7B7E\u540D\u79F0",field:"name"},{default:t(()=>[u(p,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.name=o),placeholder:"\u8BF7\u8F93\u5165\u6807\u7B7E\u540D\u79F0"},null,8,["modelValue"])]),_:1}),u(n,{label:"\u5C01\u9762\u56FE",field:"cover"},{default:t(()=>[u($,{"custom-request":T,"show-file-list":!1,accept:"image/*",limit:1,"max-size":2048,onExceed:h,onError:M},{"upload-button":t(()=>[C("div",te,[a.value.cover?(b(),k("img",{key:0,src:a.value.cover,alt:"cover",onError:U},null,40,oe)):(b(),Q(v,{key:1})),C("div",le,[u(d)])])]),_:1})]),_:1}),u(n,{label:"\u7B80\u4ECB",field:"intro"},{default:t(()=>[u(R,{modelValue:a.value.intro,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.intro=o),placeholder:"\u8BF7\u8F93\u5165\u6807\u7B7E\u7B80\u4ECB","auto-size":{minRows:3}},null,8,["modelValue"])]),_:1}),u(n,{label:"\u72B6\u6001",field:"status"},{default:t(()=>[u(z,{modelValue:a.value.status,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.status=o),"checked-value":1,"unchecked-value":0},null,8,["modelValue"])]),_:1}),u(n,{label:"\u516C\u4F17\u53F7",field:"mps_id"},{default:t(()=>[u(x,null,{default:t(()=>[u(p,{"model-value":(a.value.mps_id||[]).map(o=>o.id.toString()).join(","),placeholder:"\u8BF7\u9009\u62E9\u516C\u4F17\u53F7",readonly:"",style:{width:"300px"}},null,8,["model-value"]),u(F,{onClick:e[4]||(e[4]=o=>_.value=!0)},{default:t(()=>e[9]||(e[9]=[E("\u9009\u62E9")])),_:1,__:[9]})]),_:1})]),_:1}),u(n,null,{default:t(()=>[u(x,null,{default:t(()=>[u(F,{type:"primary","html-type":"submit",loading:y.value},{default:t(()=>e[10]||(e[10]=[E(" \u63D0\u4EA4 ")])),_:1,__:[10]},8,["loading"]),u(F,{onClick:e[5]||(e[5]=o=>V(g).go(-1))},{default:t(()=>e[11]||(e[11]=[E("\u53D6\u6D88")])),_:1,__:[11]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["loading"])]),u(j,{visible:_.value,"onUpdate:visible":e[8]||(e[8]=o=>_.value=o),title:"\u9009\u62E9\u516C\u4F17\u53F7",footer:!1,width:"800px"},{footer:t(()=>[u(F,{type:"primary",onClick:e[7]||(e[7]=o=>_.value=!1)},{default:t(()=>e[12]||(e[12]=[E("\u786E\u5B9A")])),_:1,__:[12]})]),default:t(()=>[u(X,{ref_key:"mpSelectorRef",ref:D,modelValue:a.value.mps_id,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.mps_id=o)},null,8,["modelValue"])]),_:1},8,["visible"])],64)}}});var de=G(se,[["__scopeId","data-v-88a0646e"]]);export{de as default};
